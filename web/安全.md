---
## [xss](http://www.cnblogs.com/wangyuyu/p/3388180.html)

可以通过html代码把浏览器的cookie发出去

跨站脚本攻击(Cross Site Scripting)，为不和层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故将跨站脚本攻击缩写为XSS。恶意攻击者往Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的特殊目的。

XSS利用站点内的信任用户，而CSRF则通过伪装来自受信任用户的请求来利用受信任的网站。


**正如上文所说，如果我们不需要用户输入 HTML 而只想让他们输入纯文本，那么把所有用户输入进行 HTML 转义输出是个不错的做法。Django 内置模版和 Jinja2 模版总是默认转义输出变量的。**

- HttpOnly类型的Cookie由于阻止了JavaScript对其的访问性而能在一定程度上缓解此类攻击。
- 对用户输入进行过滤来阻止XSS；


---
## [CSRF](https://juejin.im/post/5bc009996fb9a05d0a055192)

> 个人理解：用户在危险网站的请求下，带着安全网站的cookie去发出坏的请求。攻击者并没有获得第三方的cookie.拥有cookie是指浏览器端拥有cookie。

一、 CSRF（Cross-site request forgery跨站请求伪造，也被称为“One Click Attack”或者Session Riding，通常缩写为CSRF或者XSRF，是一种对网站的恶意利用。

二、CSRF 的全称是“跨站请求伪造”，而 XSS 的全称是“跨站脚本”。看起来有点相似，它们都是属于跨站攻击——不攻击服务器端而攻击正常访问网站的用户，但前面说了，它们的攻击类型是不同维度上的分 类。CSRF 顾名思义，是伪造请求，冒充用户在站内的正常操作。我们知道，绝大多数网站是通过 cookie 等方式辨识用户身份（包括使用服务器端 Session 的网站，因为 Session ID 也是大多保存在 cookie 里面的），再予以授权的。所以要伪造用户的正常操作，最好的方法是通过 **XSS** 或链接欺骗等途径，让用户在本机（**即拥有身份 cookie 的浏览器端**）发起用户所不知道的请求。


三、跨站请求伪造保护

CSRF 中间件和模板标签提供对跨站请求伪造简单易用的防护。某些恶意网站上包含链接、表单按钮或者JavaScript ，它们会利用登录过的用户在浏览器中的认证信息试图在你的网站上完成某些操作，这就是跨站攻击。还有另外一种相关的攻击叫做“登录CSRF”，攻击站点触发用户浏览器用其它人的认证信息登录到其它站点。

多窗口浏览器（firefox、遨游、MyIE……）便捷的同时也带来了一些问题，因为多窗口浏览器新开的窗口是具有当前所有会话的。
具有其他窗口的cookie

> 在恶意网站，建立一个攻击网站的表单，诱导用户点击。CSRF通常是跨域的，因为外域通常更容易被攻击者掌控。但是如果本域下有容易被利用的功能，比如可以发图和链接的论坛和评论区，攻击可以直接在本域下进行，而且这种攻击更加危险。


### 防范措施
请求应该只浏览而不改变服务器端资源。当然，最理想的做法是使用 REST 风格 的 API 设计，GET、POST、PUT、DELETE 四种请求方法对应资源的读取、创建、修改、删除。


(1).Cookie Hashing(所有表单都包含同一个伪随机值)：
实现方法非常简单，首先服务器端要以某种策略生成随机字符串，作为令牌（token）， 保存在 Session 里。然后在发出请求的页面，把该令牌以隐藏域一类的形式，与其他信息一并发出。在接收请求的页面，把接收到的信息中的令牌与 Session 中的令牌比较，只有一致的时候才处理请求，否则返回 HTTP 403 拒绝请求或者要求用户重新登陆验证身份。

!!**这可能是最简单的解决方案了，因为攻击者不能获得第三方的Cookie(理论上)，所以表单中的数据也就构造失败了:>**!!


这个方法个人觉得已经可以杜绝99%的CSRF攻击了，那还有1%呢....由于用户的Cookie很容易由于网站的XSS漏洞而被盗取，这就另外的1%。一般的攻击者看到有需要算Hash值，基本都会放弃了，某些除外，所以如果需要100%的杜绝，这个不是最好的方法。


(2).验证码
(3).One-Time Tokens(不同的表单包含一个不同的伪随机值)


最后的疑问：究竟真的不能获取到第三方的cookie么？是的，通过设置相应的浏览器页面的参数来进行限制
> 应该说是，表单提交等是不受同源策略限制的。不能获得第三方cookie指的是服务端配好相关的跨域限制，不能通过js获取到cookie。所以也有了以上的这些防范措施


## 同源策略下为什么还需要防御CSRF


对于Cookie，DOM和XMLHttpRequest（ajax）所有浏览器都会严格遵守同源策略。但是也有例外，`如<img>标签，<script>标签，<iframe>`标签等的链接会自动加载，更重要的是，**表单提交也是可以跨域的**([原因](https://www.zhihu.com/question/31592553/answer/190789780))。

来源：
- [关于ajax请求的安全，如何避免csrf类似的攻击？ - 郭小成的回答 - 知乎](https://www.zhihu.com/question/39011147/answer/152441324)


CSRF 攻击的原理，就是利用由于浏览器的同源策略对以上嵌入资源不做限制的行为进行跨站请求伪造的。

## 总结
以上介绍的防御CRSF攻击的方案，都可以概括为：颁发一个令牌token，放在严格遵循同源策略的媒介上来识别请求是否可信。 对于表单提交来说，令牌token存储在表单DOM上，其他站点无法获取到。对于Ajax提交来说，令牌token存储在Cookie上，其他站点无法获取到。

作者：郭小成
链接：https://www.zhihu.com/question/39011147/answer/152441324
来源：知乎
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

参考链接：
- https://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html
- http://www.django-china.cn/topic/580/
- http://www.cnblogs.com/wangyuyu/p/3388180.html
- https://www.jianshu.com/p/0e52c58cf93f
- https://juejin.im/post/5bc009996fb9a05d0a055192 这个写的很详细
- https://www.zhihu.com/question/39011147/answer/152441324
- https://www.zhihu.com/question/31592553/answer/190789780

---
## 点击劫持
点击劫持（clickjacking）是一种在网页中将恶意代码等隐藏在看似无害的内容（如按钮）之下，并诱使用户点击的手段。

