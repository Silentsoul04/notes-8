进程是资源分配的最小单位，意味着进程和资源是1:1，与之对应的一句话就是，线程是调度的最小单位，进程和线程是一个1:n的关系。

> 进程中使用多线程就是让共享同一批资源的操作一起进行。

这样可以极大的减少进程资源切换的开销。当我们在进行多个操作的时候，他们相互之间在切换时自然是越轻量越好。

我们可以细探一下进程切换的开销。一个进程会独占一批资源，比如使用寄存器，内存，文件等。

当切换的时候，首先会保存现场，将一系列执行的中间结果保存起来，存放在内存中的程序的代码和数据，它的栈、通用目的寄存器的内容、程序计数器、环境变量以及打开的文件描述符的集合，这个状态叫做上下文。

然后在他恢复回来的时候又需要将上述资源切换回去。显而易见，切换的时候需要保存的资源越少，系统性能就会越好，线程存在的意义就在于此。线程有自己的上下文，包括唯一的整数线程 ID，栈、栈指针、程序计数器、通用目的寄存器和条件码。

> 可以理解为线程上下文是进程上下文的子集。

程序的编写总是追求最极致的性能优化，线程的出现让共享同一批资源的程序在切换时更轻量，那有没有比线程还要轻的呢？

协程的出现让这个变成了可能，线程和进程是操作系统的支持带来的优化，而协程本质上是一种应用层面的优化了。

协程可以理解为特殊的函数，这个函数可以在某个地方挂起，并且可以重新在挂起处外继续运行，简单来说，一个线程内可以由多个这样的特殊函数在运行，但是有一点必须明确的是，一个线程的多个协程的运行是串行的。

如果是多核 CPU，多个进程或一个进程内的多个线程是可以并行运行的，但是一个线程内协程却绝对是串行的，无论 CPU 有多少个核。

毕竟协程虽然是一个特殊的函数，但仍然是一个函数。一个线程内可以运行多个函数，但这些函数都是串行运行的。当一个协程运行时，其它协程必须挂起。


