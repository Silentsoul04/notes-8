--
# wiki摘抄

Kubernetes在设计结构上定义了一系列的构建模块，其目的是为了提供一个可以共同提供部署、维护和扩展应用程序的机制。组成Kubernetes的组件设计概念为松耦合和可扩展的，这样可以使之满足多种不同的工作负载。可扩展性在很大程度上由Kubernetes API提供，此API主要被作为扩展的内部组件以及Kubernetes上运行的容器来使用。

### Pod
Kubernetes的基本调度单元称为“pod”。通过该种抽象类别可以把更高级别的抽象内容增加到容器化组件。一个pod一般包含一个或多个容器，这样可以保证它们一直位于主机上，并且可以共享资源。Kubernetes中的每个pod都被分配一个唯一的（在集群内的）IP地址这样就可以允许应用程序使用同一端口，而避免了发生冲突的问题。 Pod可以定义一个卷，例如本地磁盘目录或网络磁盘，并将其暴露在pod中的一个容器之中。。pod可以通过Kubernetes API手动管理，也可以委托给控制器来实现自动管理。

### 标签和选择器
Kubernetes使客户端（用户或内部组件）将称为“标签”的键值对附加到系统中的任何API对象，如pod和节点。相应地，“标签选择器”是针对匹配对象的标签的查询方法。

标签和选择器是Kubernetes中的主要分组机制，用于确定操作适用的组件。

例如，如果应用程序的Pods具有系统的标签 tier (比如"front-end"、"back-end") 和一个 release_track (比如"canary"、"production")，那么对所有"back-end" 和 "canary" 节点的操作可以使用如下所示的标签选择器：

tier=back-end AND release_track=canary


### 控制器

控制器是通过管理一组pod来实现来将实际集群状态转移到所需集群状态的对帐循环机制。一种控制器指的是一组具有*相同特征*的“复制控制器”，控制器通过在集群中运行指定数量的pod副本来处理复制和缩放。在基础节点出现故障的情况下，它还可以用于*处理创建替换pod*。其它控制器也是核心Kubernetes系统的一部分，包括“DaemonSet控制器”为每台机器（或机器的一些子集）上运行的单个pod，和用于运行pod的“作业控制器”。 控制器管理的pod组由作为控制器定义的部分的*标签选择器*来确定。


### 服务
Kubernetes服务本质是一组协同工作的pod，类同多层架构应用中的一层。构成服务的pod组通过标签选择器来定义。Kubernetes通过给*服务分配静态IP地址和域名*来提供服务发现机制，并且以*轮循调度*的方式将流量负载均衡到能与选择器匹配的pod的IP地址的网络连接上（即使是故障导致pod从一台机器移动到另一台机器）。 默认情况下，服务任务会暴露在集群中（例如，多个后端pod可能被分组成一个服务，前端pod的请求在它们之间负载平衡）；除此以外，服务任务也可以暴露在集群外部（例如，从客户端访问前端pod）

## 建构

### Kubernetes architecture diagram
Kubernetes遵循主从式架构设计。Kubernetes的组件可以分为管理单个的 node 组件和控制平面部分的组件。

Kubernetes Master是集群的主要控制单元，其用于*管理其工作负载并指导整个系统的通信*。Kubernetes控制平面由各自的进程组成，每个组件都可以在单个主节点上运行，也可以在支持high-availability clusters的多个主节点上运行。是Kubernetes控制平面的各种组件如下：

### etcd
etcd 是由CoreOS开发，用于可靠地存储集群的配置数据的一种持久性，轻量型的，分布式的键-值数据存储组件。该组件*可表示在任何给定时间点处的集群的整体状态*。其他组件在注意到存储的变化之后，会变成相应的状态。

### API服务器
API服务器是一个关键组件 并使用 Kubernetes API 和 JSON over HTTP来*提供了Kubernetes的内部和外部接口*。 API服务器处理和验证 REST请求并更新 API 对象的状态etcd，从而*允许客户端在Worker节点之间配置工作负载和容器*。

### 调度器
T调度程序是可插拔式组件，其基于资源可用性来选择未调度的pod（由调度程序管理的基本实体）应该运行哪个节点。调度程序跟踪每个节点上的资源利用率，以确保工作负载不会超过可用资源。为此，调度程序必须知道资源需求，资源可用性以及各种其他用户提供的约束和策略指令，例如服务质量，亲和力/反关联性要求，数据位置等。实质上，调度程序的作用是*将资源“供应”与工作负载“需求”相匹配以维持系统的稳定和可靠*。 

### 控制器管理
控制器管理器是核心Kubernetes控制器，其包括DaemonSet控制器和复制控制器等。该控制器可与API服务器进行通信以在需要时创建，*更新和删除他们管理的资源（pod，服务端点等）*

### Kubernetes 节点
Node也称为Worker或Minion，是部署容器（工作负载）的单机器（或虚拟机）。集群中的每个节点都必须具备容器的运行环境（runtime） ——比如 Docker，以及下面提到的其他组件，以便与这些容器的网络配置进行通信。

### Kubelet
Kubelet负责*每个节点的运行状态（即确保节点上的所有容器都正常运行）*。它按照控制面板的指示来处理启动，停止和维护应用程序容器（按组织到pod中）。

Kubelet会监视pod的状态，如果不处于所需状态，则pod将被重新部署到同一个节点。节点状态每隔几秒就会传递消息至中继主机。主控器检测到节点故障后，复制控制器将观察此状态更改，并在其他健康节点上启动pod]

### 容器
容器从属于pod。在运行应用、库及其依赖的微服务中，*容器是最低层级的*。通过绑定一个外部IP，容器可以被外网访问。

### Kube代理
Kube代理是*网络代理和负载均衡的实现*，支持服务抽象以及其他网络操作。根据传入请求的IP和端口，该组件会将流量转发到指定的合适的容器中。

### cAdvisor
cAdvisor 是监视和收集例如每个节点上的容器的CPU，内存，文件和网络使用情况等的资源使用情况和性能指标的代理组件。

[wiki](https://zh.wikipedia.org/wiki/Kubernetes)

---

与你过去使用的其他系统不同，Kubernetes不直接运行容器;相反，它将一个或多个容器封装到一个称为Pod的高级结构中。相同Pod中的任何容器都将共享相同的名称空间和本地网络。容器可以很容易地与其他容器在相同的容器中进行通信，就像它们在同一台机器上同时保持一定程度的隔离。

Pod被用作Kubernetes的复制单元。如果你的应用程序太受欢迎，单个的Pod实例无法承载负载，那么可以配置Kubernetes以在必要时将你的Pod的新副本部署到集群。即使在没有重载的情况下，在生产系统中任何时候都要有多个副本，以保证负载均衡和故障抵抗。

**Pod可以容纳多个容器，但在可能的情况下应该限制自己**。因为Pod作为一个单位被放大和缩小时，所有在一个Pod里的容器都必须在一起缩放，不管它们是否需要。这将导致资源的浪费和成本增加。为了解决这个问题，Pod应该保持尽可能小的大小，通常只保留一个主进程和紧密耦合的辅助容器(这些辅助容器通常被称为“侧三轮摩托车”)。

- [Kubernetes入门：Pod、节点、容器和集群都是什么？](https://zhuanlan.zhihu.com/p/32618563)